<div class="wizard-pf">
  <div class="wizard-pf-body clearfix">
    <div ng-if="wizard.isWizard" class="wizard-pf-steps">
      <ul class="wizard-pf-steps-indicator">
        <li class="wizard-pf-step {{resolveActiveTab('configurations',1) ? 'active' : ''}}" data-tabgroup="1">
          <a ng-click="goTo('users/extensions')"><span class="wizard-pf-step-number">1</span><span
              class="wizard-pf-step-title">{{'Configurations' | translate}}</span></a>
        </li>
      </ul>
    </div>
  </div>
  <div class="wizard-pf-contents adjust-size no-margin-bottom">
    <h1 class="control-label centered" for="textInput-markup">{{'Configurations' | translate}}</h1>
    <div class="container-fluid margin-top-lg">
      <div class="form-group">
        <div class="filter-label-user adjust-filter-user">{{'Filter' | translate}}:</div>
        <select class="adjust-filter-user" title="-" pf-select="{ width: '180px' }" ng-model="usersFilter" ng-options="uf as uf | translate for uf in availableUserFilters">
        </select>
        <div class="filter-label-user-order">
          <select title="-" pf-select="{ width: '180px' }" ng-model="usersFilterNumbers" ng-options="uf as uf | translate for uf in availableUserFiltersNumbers"></select>
          <i class="fa fa-sort-alpha-asc"></i>
        </div>
      </div>
      <form role="form" class="search-pf has-button adjust-form" id="form-lg-domains-details">
        <div class="form-group">
          <div class="search-pf-input-group">
            <input
              ng-model="searchUser"
              type="text"
              class="form-control input-lg ng-binding"
              placeholder="{{'Search users' | translate}}...">
          </div>
        </div>
        <div class="form-group">
          <button class="btn btn-default btn-lg" type="submit">
            <span class="fa fa-search"></span>
          </button>
        </div>
      </form>
    </div>
    <div id="configurationList" class="list-group list-view-pf list-view-pf-view mt-20" when-scrolled="loadMoreUsers()" ng-style="{'height': usersHeight}">
      <!-- repeat  -->
      <div
        ng-repeat="user in allUsers | customFilterMultiple:'displayname,username,default_extension':searchUser | limitTo: usersLimit | orderBy:usersFilterNumbers"
        ng-show="usersFilter == 'configured' ? user.devices.length > 0 : (usersFilter == 'unconfigured' ? user.devices.length == 0 : true)"
        class="list-group-item {{user.username == currentUser.username || user.username == linkTo ? 'list-view-pf-expand-active' : ''}}">
        <div class="list-group-item-header">
          <div class="list-view-pf-actions">
            <div>
              <button
                ng-click="openDevices(user)"
                data-toggle="modal"
                data-target="#devicesAssociation"
                type="button"
                class="btn btn-primary">
                  {{"Link device" | translate}}
              </button>
            </div>
          </div>
          <div ng-click="setCurrentUser(user)" class="list-view-pf-main-info">
            <div class="list-view-pf-left"><span aria-hidden="true" class="fa fa-user list-view-pf-icon-sm"></span>
            </div>
            <div class="list-view-pf-body">
              <div class="list-view-pf-description">
                <div class="list-group-item-heading">{{user.username}} - {{user.default_extension}}</div>
                <div class="list-group-item-text">{{user.displayname}}</div>
              </div>
              <div class="list-view-pf-additional-info">
                <div class="list-view-pf-additional-info-item"><span class="fa fa-cubes"></span><strong>{{user.devices.length}}</strong>
                  {{ (user.devices.length !== 1 ? "Devices" : "Device") | translate }}</div>
              </div>
            </div>
          </div>
        </div>
        <div ng-show="!hiddenUser[user.username]" ng-if="currentUser.username == user.username" class="list-group-item-container container-fluid cursor-default">
          <div ng-show="loadingUser[user.username]" class="spinner mt-14 mb-14"></div>
          <div ng-show="!loadingUser[user.username]" class="col-lg-12 plateral-10">
            <div id="configSettings" class="settings-container">
              <div class="list-group-item back-whitesmoke cursor-default border-color-whitesmoke mt-15">
                <div class="list-group-item-header back-whitesmoke cursor-default">
                  <div class="list-view-pf-main-info pb-12 pt-12">
                    <div class="list-view-pf-left">
                      <span aria-hidden="true"
                        class="fa fa-cogs list-view-pf-icon-sm no-border-left no-border-right no-border-top no-border-radius border-bottom-color-grey">
                      </span>
                    </div>
                    <div class="list-view-pf-body">
                      <div class="list-view-pf-description">
                        <div class="list-group-item-heading">{{ 'User settings' | translate }}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="list-group-item">
                <div class="list-group-item-header background-white">
                  <div class="list-view-pf-main-info cursor-default background-white mt-10">
                    <div class="col-lg-12">
                      <div class="col-lg-6">
                        <form class="form-horizontal">
                          <div class="form-group">
                            <label class="control-label" for="textInputDisabled-markup">
                            <!-- <i class="fa fa-user mr-7"></i> -->
                            {{"Profile" | translate}}</label>
                            <select class="mt-3" ng-change="setProfile()" title="-" pf-select="{ width: '100%' }" ng-model="currentUser.profile"
                              ng-options="p.id as p.name | translate for p in allProfiles">
                            </select>
                          </div>
                          <div class="form-group">
                            <label class="control-label" for="textInput-markup">
                              <!-- <i class="fa fa-users mr-7"></i> -->
                              {{"Group" | translate}}
                            </label>
                            <select class="mt-3" multiple ng-change="setGroup()" title="-" pf-select="{ width: '100%' }" ng-model="currentUser.groups"
                              ng-options="p.id as p.name for p in allGroups">
                            </select>
                          </div>
                        </form>
                      </div>
                      <div class="col-lg-6">
                        <form class="form-horizontal" ng-submit="setMobileExtension(currentUser)">
                          <div class="form-group">
                            <label class="control-label" for="textInput-markup">
                              <!-- <i class="fa fa-phone mr-7"></i> -->
                              {{"Mobile" | translate}}
                            </label>
                            <div class="display-flex mt-3">
                              <input
                                ng-model="currentUser.mobile"
                                type="tel"
                                class="form-control config-form"
                                placeholder="{{'Mobile' | translate}}">
                              <button
                                type="submit"
                                class="btn btn-default adjust-button"
                                aria-haspopup="true"
                                aria-expanded="false">
                                {{"Set" | translate}}
                              </button>
                              <span ng-if="currentUser.setMobileInAction == 'ok'" class="pficon pficon-ok fz-18 absolute-position mt-3 right-5"></span>
                              <span ng-if="currentUser.setMobileInAction == 'err'" class="pficon pficon-error-circle-o fz-18  absolute-position mt-3 right-5"></span>
                              <div ng-if="currentUser.setMobileInAction == true" class="spinner spinner-sm language-name absolute-position mt-3 right-5"></div>
                            </div>
                          </div>
                          <div class="form-group">
                            <label class="control-label" for="textInputDisabled-markup">
                              <!-- <i class="fa fa-envelope mr-7"></i> -->
                              {{"Voicemail" | translate}}
                            </label>
                            <div class="mt-3">
                              <input
                                bs-switch
                                ng-model="currentUser.voiceMailState"
                                ng-change="setVoiceMail()"
                                id="bootstrap-switch-voicemail-{{currentUser.id}}"
                                class="bootstrap-switch bootstrap-switch-voicemail col-lg-6 col-md-6 col-sm-12 col-xs-12"
                                type="checkbox">
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div id="configDevices" class="devices-container mb-15">
              <div class="list-group-item back-whitesmoke cursor-default border-color-whitesmoke mt-25">
                <div class="list-group-item-header back-whitesmoke cursor-default">
                  <div class="list-view-pf-main-info pb-12 pt-12">
                    <div class="list-view-pf-left">
                      <span aria-hidden="true"
                        class="fa fa-cubes list-view-pf-icon-sm no-border-left no-border-right no-border-top no-border-radius border-bottom-color-grey">
                      </span>
                    </div>
                    <div class="list-view-pf-body">
                      <div class="list-view-pf-description">
                        <div class="list-group-item-heading">{{"Linked devices" | translate}}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div ng-repeat="device in user.devices">
                <!-- devices -->
                <div ng-if="device.type == 'physical'" class="list-group-item cursor-default ng-scope">
                  <div class="list-view-pf-actions">
                    <div class="display-flex">
                      <button
                        ng-click="deletePhysicalExtension(device, device.extension)"
                        class="btn btn-default mr-2">
                        {{"Unlink" | translate}}
                      </button>
                      <span ng-if="device.setPhysicalInAction == 'ok'" class="pficon pficon-ok fz-18 ml-5 mt-3"></span>
                      <span ng-if="device.setPhysicalInAction == 'err'" class="pficon pficon-error-circle-o fz-18 ml-5 mt-3"></span>
                      <div ng-if="device.setPhysicalInAction == true" class="spinner spinner-sm ml-5 mt-3"></div>
                      <button
                        ng-if="device.mac"
                        class="btn btn-default {{device.registered ? '' : ''}}"
                        ng-click="rebootDevice(device)"
                        popover-placement="top"
                        popover-trigger="'mouseenter'"
                        popover-animation="true"
                        uib-popover="{{device.registered ? 'reboot_device' : 'cant_reboot_not_registered' | translate}}">
                        <i class="fa fa-retweet"></i>
                      </button>
                      <span ng-if="device.rebootInAction == 'ok'" class="pficon vertical-sub pficon-ok fz-18 ml-5 mt-3"></span>
                      <span ng-if="device.rebootInAction == 'err'"
                        class="pficon vertical-sub pficon-error-circle-o fz-18 ml-5 mt-3"
                        popover-placement="top"
                        popover-trigger="'mouseenter'"
                        popover-animation="true"
                        uib-popover="{{'Error rebooting phone' | translate}}"></span>
                      <div ng-if="device.rebootInAction == true" class="spinner vertical-sub inline-display spinner-sm ml-5 mt-3"></div>
                    </div>
                  </div>
                  <div class="list-view-pf-main-info">
                    <div class="list-view-pf-left">
                      <span class="fa fa-phone list-view-pf-icon-sm "></span>
                    </div>
                    <div class="list-view-pf-body">
                      <div class="list-view-pf-description">
                        <div class="list-group-item-heading configDevices-item-heading">
                          <span ng-if="device.manufacturer">{{device.manufacturer}}</span>
                          <span ng-if="!device.mac && (device.type === 'physical' || device.type === 'temporaryphysical')">
                            {{"Custom" | translate}}
                          </span>
                          - <span>{{device.extension}}</span>
                        </div>
                        <span class="weight-plus mr-20">
                        </span>
                        <div class="list-group-item-text">
                          <div class="col-lg-7">
                            <!-- model select for non-custom devices -->
                            <div class="form-group no-margin-bottom" ng-if="!(!device.mac && (device.type === 'physical' || device.type === 'temporaryphysical'))">
                              <div class="display-flex">
                                <select
                                  pf-select="{ noneSelectedText: '-' }"
                                  data-live-search="true"
                                  data-size="5"
                                  ng-change="setDeviceModel(device)"
                                  ng-model="device.model"
                                  ng-options="model.display_name for model in device.filteredModels | orderBy:orderByValue"
                                >
                                  <option value="">{{ 'No model' | translate }}</option>
                                </select>
                                <button ng-click="setCurrentModelConf(device.model)" data-toggle="modal"
                                  data-target="#singleModelModal"
                                  class="btn btn-default mln-1 zindex-2">
                                  <i class="fa fa-pencil"></i>
                                </button>
                              </div>
                            </div>
                            <!-- show secret for custom devices -->
                            <button ng-if="!device.mac && (device.type === 'physical' || device.type === 'temporaryphysical')" popover-animation="true" uib-popover="{{device.secret}}" type="button" class="btn btn-default">{{'Show secret' | translate}}</button>
                          </div>
                        </div>
                      </div>
                      <div class="list-view-pf-additional-info config-info ">
                        <!-- mac for non-custom devices -->
                        <div ng-if="!(!device.mac && (device.type === 'physical' || device.type === 'temporaryphysical'))">
                          MAC: <b class="ng-binding">{{ device.mac }}</b>
                        </div>
                        <!-- web credentials for custom devices -->
                        <div ng-if="!device.mac && (device.type === 'physical' || device.type === 'temporaryphysical')">
                          <div>
                            {{'Web user' | translate}}:
                            <b>{{device.web_user}}</b>
                          </div>
                          <div>{{'Web password' | translate}}:
                            <b>{{device.web_password}}</b>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- webrtc -->
              <div class="list-group-item abstract-item cursor-default ng-scope">
                <div class="list-view-pf-actions">
                  <div class="display-flex">
                  </div>
                </div>
                <div class="list-view-pf-main-info">
                  <div class="list-view-pf-left">
                    <span class="fa fa-headphones list-view-pf-icon-sm "></span>
                  </div>
                  <div class="list-view-pf-body">
                    <div class="list-view-pf-description">
                      <div class="list-group-item-heading configDevices-item-heading">
                        {{"Web Phone" | translate}}
                        <span ng-repeat="device in user.devices" ng-if="device.type == 'webrtc'">
                          <span>-</span> <span>{{device.extension}}</span>
                        </span>
                      </div>
                      <span class="weight-plus">
                      </span>
                      <div class="list-group-item-text">
                        <div class="col-lg-6">
                          <div class="form-group no-margin-bottom">
                            <div class="display-flex">
                              <input 
                                bs-switch 
                                ng-model="currentUser.webRtcState"
                                ng-change="setWebRTC()"
                                id="bootstrap-switch-webrtc-{{currentUser.id}}"
                                class="bootstrap-switch bootstrap-switch-webrtc col-lg-6 col-md-6 col-sm-12 col-xs-12"
                                type="checkbox">
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="list-view-pf-additional-info config-info">
                    </div>
                  </div>
                </div>
              </div>
              <!-- mobile app -->
              <!-- <div class="list-group-item abstract-item cursor-default ng-scope">
                <div class="list-view-pf-actions">
                  <div class="display-flex">
                  </div>
                </div>
                <div class="list-view-pf-main-info">
                  <div class="list-view-pf-left">
                    <span class="fa fa-mobile list-view-pf-icon-sm "></span>
                  </div>
                  <div class="list-view-pf-body">
                    <div class="list-view-pf-description">
                      <div class="list-group-item-heading configDevices-item-heading">
                        {{"Mobile App" | translate}} - <span>92202</span>
                      </div>
                      <span class="weight-plus">
                      </span>
                      <div class="list-group-item-text">
                        <div class="col-lg-6">
                          <div class="form-group no-margin-bottom">
                            <div class="display-flex">
                              <input on-element-render="switchRenderEnd" class="bootstrap-switch" type="checkbox" checked>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="list-view-pf-additional-info config-info ">
                    </div>
                  </div>
                </div>
              </div> -->
            </div>
          </div>
        </div>
      </div>
      <!-- end repeat -->
    </div>
    <div ng-if="false" class="blank-slate-pf ">
      <div class="blank-slate-pf-icon">
        <span class="pficon pficon-users"></span>
      </div>
      <h1>
        {{'No users found' | translate}}
      </h1>
      <p ng-if="!mode.isLdap">
        {{'Check your LDAP or Active Directory settings' | translate}}
      </p>
      <div ng-if="providerLocal" class="blank-slate-pf-main-action">
        <button data-toggle="modal" data-target="#createUser"
          class="btn btn-primary btn-lg">{{'Create user' | translate}}</button>
        <button ng-click="fileSelectImport()" class="btn btn-primary btn-lg no-margin">{{'Import' | translate}}</button>
        <input ng-model="temp.importFile" type="file" accept=".csv" id="importInput">
      </div>
    </div>

  </div>
  <!-- <wizard-step ng-if="wizard.isWizard" id="wizardStepBase"></wizard-step> -->
</div>

<div class="modal fade" id="devicesAssociation" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="wizard-modal">
    <div class="modal-dialog wizard-pf margin-10">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            <span class="pficon pficon-close"></span>
          </button>
          <h4 class="modal-title" id="dfSettingsMLabel">{{'Link device' | translate}}</h4>
        </div>
        <form class="form-horizontal">
          <div class="modal-body">
            <div class="col-lg-12 mb-5 mt-5">
              <form role="form" class="search-pf has-button adjust-form" id="form-lg-domains-details">
                <div class="form-group has-clear mt-10 no-lateral-margins display-flex">
                  <div class="search-pf-input-group full-width" id="filter-domains-details">
                    <input
                      ng-model="searchDeviceString"
                      type="text"
                      class="form-control input-lg ng-pristine ng-valid ng-touched"
                      placeholder=" {{'Search devices' | translate}}...">
                  </div>
                  <button class="btn btn-default btn-lg mln-1" type="submit">
                    <span class="fa fa-search"></span>
                  </button>
                </div>
              </form>
              <h1 class="control-label config-title-user mt-10" for="textInput-markup">
                <div class="fz-15 mb-10">
                  <span class="weight-plus ng-binding">{{devicesNotLinked.length}} {{ (devicesNotLinked.length !== 1 ? "Devices" : "Device") | translate }}</span>
                </div>
              </h1>
              <div id="devices-not-linked-list" when-scrolled="loadMoreDevicesNotLinked()" ng-style="{'height': devicesNotLinkedHeight}">
                <!-- custom device -->
                <div class="list-group-item cursor-default back-whitesmoke">
                  <div class="list-view-pf-actions mt-48">
                    <button
                      class="btn btn-primary"
                      ng-click="setPhysicalExtension(newDevice)">
                      {{"Link to" | translate}} {{linkTo || ("user" | translate)}}
                    </button>
                    <span ng-if="newDevice.linkInAction == 'ok'" class="pficon vertical-sub pficon-ok fz-18 ml-5"></span>
                    <span ng-if="newDevice.linkInAction == 'err'" class="pficon vertical-sub pficon-error-circle-o fz-18 ml-5"></span>
                    <div ng-if="newDevice.linkInAction == true" class="spinner vertical-sub inline-display spinner-sm ml-5"></div>
                  </div>
                  <div class="list-view-pf-main-info ">
                    <div class="list-view-pf-left">
                      <span class="fa fa-phone list-view-pf-icon-sm "></span>
                    </div>
                    <div class="list-view-pf-body">
                      <div class="list-view-pf-description">
                        <div class="list-group-item-heading configDevices-item-heading">
                          {{'New custom device' | translate}}
                        </div>
                        <span class="weight-plus mr-20">
                        </span>
                        <div class="list-group-item-text">
                          <div class="col-lg-7">
                          </div>
                        </div>
                      </div>
                      <div class="list-view-pf-additional-info config-info">
                        <div>{{'Web user' | translate}}:
                          <input class="form-control" placeholder="admin" ng-model="newDevice.web_user">
                        </div>
                        <div>{{'Web password' | translate}}:
                          <input class="form-control" placeholder="admin" ng-model="newDevice.web_password">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>  
                <!-- devices -->
                  <div
                    ng-show="!devicesLoading"
                    ng-repeat="device in devicesNotLinked | customFilterMultiple:'mac,manufacturer,model':searchDeviceString | limitTo: devicesNotLinkedLimit"
                    class="list-group-item cursor-default">
                    <div class="list-view-pf-actions">
                      <button
                        ng-click="setPhysicalExtension(device)"
                        class="btn btn-primary">
                        {{"Link to" | translate}} {{linkTo || ("user" | translate)}}
                      </button>
                      <span ng-if="device.linkPhysicalInAction == 'ok'" class="pficon vertical-sub pficon-ok fz-18 ml-5"></span>
                      <span ng-if="device.linkPhysicalInAction == 'err'" class="pficon vertical-sub pficon-error-circle-o fz-18 ml-5"></span>
                      <div ng-if="device.linkPhysicalInAction == true" class="spinner vertical-sub inline-display spinner-sm ml-5"></div>
                    </div>
                    <div class="list-view-pf-main-info ">
                      <div class="list-view-pf-left">
                        <span class="fa fa-phone list-view-pf-icon-sm "></span>
                      </div>
                      <div class="list-view-pf-body">
                        <div class="list-view-pf-description">
                          <div class="list-group-item-heading configDevices-item-heading">
                            {{ device.manufacturer && device.model !== 'custom' ? device.manufacturer : '-' }}
                          </div>
                          <span class="weight-plus mr-20 width-33p">
                            {{ device.model.display_name ? device.model.display_name : '-' }}
                          </span>
                          <div class="list-group-item-text">
                            <div class="col-lg-7">
                            </div>
                          </div>
                        </div>
                        <div class="list-view-pf-additional-info config-info width-15p">
                          <div ng-if="device.mac">MAC: <b>{{device.mac}}</b></div>
                        </div>
                      </div>
                    </div>
                </div>
              </div>
            </div>
            <div class="modal-footer submit">
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="singleModelModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="wizard-model-modal">
    <div class="modal-dialog wizard-pf margin-10">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            <span class="pficon pficon-close"></span>
          </button>
          <h4 class="modal-title" id="dfSettingsMLabel">{{'Single Model Editing' | translate}}</h4>
        </div>
        <div class="modal-body">
          <div class="mb-10 mt-5">
            <!-- start model ui -->
            <div ng-include="modelsUIUrl"></div>
            
          </div>
        </div>
      </div>
    </div>
  </div>
</div>